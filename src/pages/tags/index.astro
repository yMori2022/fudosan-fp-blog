---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import TagLink from '@/components/TagLink.astro';

const all = await getCollection('blog');
const posts = all.filter((p) => !p.data.draft);

const counts = new Map<string, number>();
for (const p of posts) {
  for (const tag of p.data.tags ?? []) {
    counts.set(tag, (counts.get(tag) ?? 0) + 1);
  }
}

const tags = Array.from(counts.entries())
  .map(([name, count]) => ({ name, count }))
  .sort((a, b) => a.name.localeCompare(b.name, 'ja'));
---

<Layout>
  <section class="bg-gradient-to-b from-white to-slate-50 dark:from-zinc-900 dark:to-zinc-950 border-b">
    <div class="mx-auto max-w-3xl px-4 py-14">
      <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight text-slate-900 dark:text-white">タグ一覧</h1>
      <p class="mt-3 text-slate-600 dark:text-slate-300">タグから記事を探せます。</p>
    </div>
  </section>

  <main class="mx-auto max-w-3xl px-4 py-10">
    {tags.length === 0 ? (
      <p class="text-slate-600 dark:text-slate-300">タグがまだありません。</p>
    ) : (
      <ul class="flex flex-wrap gap-2">
        {tags.map(({ name, count }) => (
          <li>
            <TagLink tag={name} size="md">
              <span class="inline-flex items-center justify-center min-w-6 h-6 rounded-full bg-white/70 dark:bg-zinc-900/60 border border-slate-200/70 dark:border-zinc-700 text-xs px-1">{count}</span>
            </TagLink>
          </li>
        ))}
      </ul>
    )}
  </main>
</Layout>
